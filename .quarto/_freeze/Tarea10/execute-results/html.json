{
  "hash": "a6210af6628384df0501086d3eabfd41",
  "result": {
    "markdown": "# Tarea 10\n\n\n::: {#exr-1}\n\nConsidere la ecuación diferencial estocástica lineal con ruido multiplicativo.\n$$\n\\mathrm{d}Y\\left(t\\right)=\\left(\\mu+\\dfrac{1}{2}\\sigma^{2}\\right)Y\\left(t\\right)\\mathrm{d}t+\\sigma\\mathrm{d}W\\left(t\\right)\n$$\n\nAplicando la Fórmula de Ito a la función \n\n$$\nu\\left(t,x\\right)=y_{0}\\exp\\left(\\mu t+\\sigma x\\right).\n$$\n\nMuestre que \n\n$$\nY\\left(t\\right)=Y\\left(0\\right)\\exp\\left(\\mu t+\\sigma W\\left(t\\right)\\right),\n$$\n\nresuelve la ecuación diferencial.\n\n:::\n\nConsidere \n$$\nu\\left(t,x\\right)=y_{0}\\exp\\left(\\mu t+\\sigma x\\right)\n$$\n\nAhora \n\\begin{align*}\n\\partial_{t}u & =\\mu u\\\\\n\\partial_{x}u & =\\sigma u\\\\\n\\partial_{xx} & =\\sigma^{2}u\n\\end{align*}\n\nUsando además que. \n\n$$\n\\mathrm{d}S_{t}=\\mathrm{d}W_{t}\n$$\n\nEntonces \n\\begin{align*}\n\\mathrm{d}u\\left(t,Y_{t}\\right) & =\\mu u\\mathrm{d}t+\\sigma u\\mathrm{d}Y_{t}+\\dfrac{1}{2}\\sigma^{2}u\\left(\\mathrm{d}Y_{t}\\right)^{2}\\\\\n & =\\mu u\\mathrm{d}t+\\sigma u\\mathrm{d}W_{t}+\\dfrac{1}{2}\\sigma^{2}u\\mathrm{d}t\\\\\n & =\\left(\\mu+\\dfrac{1}{2}\\sigma^{2}\\right)u\\mathrm{dt+\\sigma u\\mathrm{d}}W_{t}\n\\end{align*}\n\nEntonces \n\\begin{align*}\nY_{t} & =u\\left(t,Y_{t}\\right)\\\\\n & =Y\\left(0\\right)\\exp\\left(\\mu t+\\sigma W_{t}\\right)\n\\end{align*}\n\nEn general \n$$\n\\mathrm{d}X_{t}=\\mu X_{t}\\mathrm{d}t+\\sigma X_{t}\\mathrm{d}W_{t}\n$$\n\n\n\n\n\n::: {#exr-1}\n\nUse el hecho anterior, confirma que \n\n$$\nY\\left(t\\right)=Y\\left(0\\right)\\exp\\left(\\left(\\mu-\\dfrac{1}{2}\\sigma^{2}\\right)t+\\sigma W\\left(t\\right)\\right),\n$$\n\nresuelve, \n\n$$\n\\mathrm{d}Y\\left(t\\right)=\\mu Y\\left(t\\right)\\mathrm{d}t+\\sigma Y\\left(t\\right)\\mathrm{d}W\\left(t\\right)\n$$\n\n:::\n\nConsidere \n$$\nu\\left(t,x\\right)=y_{0}\\exp\\left(q_{1}t+q_{2}x\\right)\n$$\n\nAhora \n\\begin{align*}\n\\partial_{t}u & =q_{1}u\\\\\n\\partial_{x}u & =q_{2}u\\\\\n\\partial_{xx} & =q_{2}^{2}u\n\\end{align*}\n\nUsando además que. \n\n$$\n\\mathrm{d}S_{t}=\\mathrm{d}W_{t}\n$$\n\nEntonces \n\\begin{align*}\n\\mathrm{d}u\\left(t,Y_{t}\\right) & =q_{1}u\\mathrm{d}t+q_{2}u\\mathrm{d}Y_{t}+\\dfrac{1}{2}q_{2}^{2}u\\left(\\mathrm{d}Y_{t}\\right)^{2}\\\\\n & =q_{1}u\\mathrm{d}t+q_{2}u\\mathrm{d}W_{t}+\\dfrac{1}{2}q_{2}^{2}u\\mathrm{d}t\\\\\n & =\\left(q_{1}+\\dfrac{1}{2}q_{2}^{2}\\right)u\\mathrm{d}t+q_{2}u\\mathrm{d}W_{t},\n\\end{align*}\nentonces, \n\\begin{align*}\nq_{2} & =\\sigma\\\\\nq_{1}+\\dfrac{1}{2}\\sigma^{2} & =\\mu,\n\\end{align*}\n\nentonces \n$$\nY_{t}=Y\\left(0\\right)\\exp\\left(\\mu t+\\sigma W_{t}\\right)\n$$\n\n\n\n\n\n::: {#exr-1}\n\nConsidere la siguiente ecuación diferencial estocástica lineal. \n$$\n\\mathrm{d}S\\left(t\\right)=\\left(a_{1}\\mathrm{S}\\left(t\\right)+a_{2}\\right)\\mathrm{d}t+g\\left(S\\left(t\\right)\\right)\\mathrm{d}W\\left(t\\right),\n$$\n\ndonde $g:\\mathbb{R}\\to\\mathbb{R}$ es cualquier función global de\nLipschitz con crecimiento lineal, y $a_{1},a_{2}$ son dos constantes\ndiferentes de cero. Use la forma integral de la ecuación diferencial\nestocástica, la propiedad de martingala de la integral de Ito y la\nnotación \n$$\nm\\left(t\\right)=E\\left[X_{t}\\right],\n$$\npara deducir que \n$$\nm\\left(t\\right)-m\\left(0\\right)=a_{1}\\int_{0}^{t}m\\left(s\\right)\\mathrm{d}s+a_{2}t\n$$\n\nUsando que $m\\left(t\\right)$ es la solución \n$$\n\\dfrac{\\mathrm{d}m\\left(t\\right)}{\\mathrm{d}t}=a_{1}m\\left(t\\right)+a_{2},m\\left(0\\right)=E\\left[X_{0}\\right]\n$$\n\nFinalmente, muestre que \n$$\nE\\left[X\\left(t\\right)\\right]=-\\dfrac{a_{2}}{a_{1}}+\\left(E\\left[X\\left(0\\right)\\right]+\\dfrac{a_{2}}{a_{1}}\\right)\\exp\\left(a_{1}t\\right)\n$$\n\n:::\n\n\nPrimero. Considerando la formula Integral. \n\n\\begin{align*}\nS\\left(t\\right) & =S\\left(0\\right)+\\int_{0}^{t}\\left(a_{1}\\mathrm{S}\\left(t\\right)+a_{2}\\right)\\mathrm{d}t+\\int_{0}^{t}g\\left(S\\left(s\\right)\\right)\\mathrm{d}W\\left(s\\right)\\\\\n & =S\\left(0\\right)+a_{1}\\int_{0}^{t}\\mathrm{S}\\left(t\\right)\\mathrm{d}t+a_{2}t+\\int_{0}^{t}g\\left(S\\left(s\\right)\\right)\\mathrm{d}W\\left(s\\right),\n\\end{align*}\n\ncalculamos la esperanza. \n\\begin{align*}\nm\\left(t\\right) & =m\\left(0\\right)+a_{1}\\int_{0}^{t}m\\left(t\\right)\\mathrm{d}t+a_{2}t+\\int_{0}^{t}E\\left[g\\left(S\\left(s\\right)\\right)\\right]\\mathrm{d}B\\left(s\\right)\\\\\nm\\left(t\\right)-m\\left(0\\right) & =a_{1}\\int_{0}^{t}m\\left(t\\right)\\mathrm{d}t+a_{2}t+E\\left[\\int_{0}^{t}g\\left(S\\left(s\\right)\\right)\\mathrm{d}B\\left(s\\right)\\right]\n\\end{align*}\n\nComo $g$ es de lipschitz y con crecimiento lineal $g\\left(S\\right)\\in L_{\\text{ad}}^{2}\\left(\\Omega_{a}^{b}\\right),$\npor lo tanto existe una constante $c$ tal que \n$$\nE\\left[\\int_{0}^{t}g\\left(S\\left(s\\right)\\right)\\mathrm{d}W\\left(s\\right)\\right]=c,\\ \\forall t\n$$\n\nLuego, sabemos que \n$$\n\\int_{0}^{t}g\\left(S\\left(s\\right)\\right)\\mathrm{d}W\\left(s\\right)=\\lim_{n\\to\\infty}\\sum_{i=1}^{n}g\\left(S\\left(t_{i-1}\\right)\\right)\\left(B_{i}-B_{i-1}\\right),\n$$\n\nahora, para cada $i$ \n\\begin{align*}\nE\\left[g\\left(S\\left(t_{i-1}\\right)\\right)\\left(B_{i}-B_{i-1}\\right)\\right] & =E\\left[E\\left[g\\left(S\\left(t_{i-1}\\right)\\right)\\left(B_{i}-B_{i-1}\\right)\\mid\\mathcal{F}_{i-1}\\right]\\right]\\\\\n & =E\\left[g\\left(S\\left(t_{i-1}\\right)\\right)E\\left[\\left(B_{i}-B_{i-1}\\right)\\mid\\mathcal{F}_{i-1}\\right]\\right]\\\\\n & =0,\n\\end{align*}\n\npor lo tanto \n$$\nm\\left(t\\right)-m\\left(0\\right)=a_{1}\\int_{0}^{t}m\\left(t\\right)\\mathrm{d}t+a_{2}t,\n$$\n\nahora, considere su forma diferencial. \n$$\n\\dfrac{\\mathrm{d}m\\left(t\\right)}{\\mathrm{d}t}=a_{1}m\\left(t\\right)+a_{2},\n$$\n\nes una ecuación diferencial lineal. Por lo tanto usaremos métodos\nconocidos para resolverla. \n$$\n\\dfrac{\\mathrm{d}m\\left(t\\right)}{\\mathrm{d}t}-a_{1}m\\left(t\\right)=a_{2},\n$$\ndefina \n\\begin{align*}\nu & =\\exp\\left(\\int a_{1}\\mathrm{d}t\\right)\\\\\n & =e^{-a_{1}t},\n\\end{align*}\n\n\\begin{align*}\n\\dfrac{\\mathrm{d}}{\\mathrm{d}t}\\left[um\\left(t\\right)\\right] & =a_{2}u\\\\\nu\\left(t\\right)m\\left(t\\right) & =a_{2}\\int u\\left(t\\right)\\mathrm{d}t\\\\\nm\\left(t\\right) & =\\dfrac{a_{2}}{u\\left(t\\right)}\\int u\\left(t\\right)\\mathrm{d}t\\\\\n & =a_{2}e^{a_{1}t}\\int e^{-a_{1}t}\\mathrm{d}t\\\\\n & =-a_{2}e^{a_{1}t}\\left[-\\dfrac{1}{a_{1}}e^{-a_{1}t}+C\\right]\\\\\nm\\left(t\\right) & =-\\dfrac{a_{2}}{a_{1}}-Ca_{2}e^{a_{1}t}\n\\end{align*}\n\nAhora, recordando la condición inicial. \n\\begin{align*}\nm\\left(0\\right) & =-\\dfrac{a_{2}}{a_{1}}-Ca_{2}\\\\\n\\Rightarrow C & =-\\dfrac{1}{a_{1}}-\\dfrac{1}{a_{2}}m\\left(0\\right).\n\\end{align*}\n\nEntonces \n$$\nE\\left[X_{t}\\right]=-\\dfrac{a_{2}}{a_{1}}-\\left[-\\dfrac{a_{2}}{a_{1}}-E\\left[X_{0}\\right]\\right]\\exp\\left(a_{1}t\\right)\n$$\n\n\n::: {#exr-1}\n\nConsidere la siguiente ecuación diferencial estocástica lineal. \n$$\n\\mathrm{d}S\\left(t\\right)=\\left(\\alpha\\left(t\\right)\\mathrm{S}\\left(t\\right)\\right)\\mathrm{d}t+\\beta\\left(t\\right)S\\left(t\\right)\\mathrm{d}W\\left(t\\right),S\\left(0\\right)=s_{0},\n$$\n\ncon constantes $s_{0}$ y funciones $\\alpha,\\beta$ integrables. Use\nla formula de Ito con la fórmula \n$$\nu\\left(t,x\\right)=\\ln\\left(\\dfrac{x}{S_{0}}\\right),\n$$\npara deducir que \n$$\nS\\left(t\\right)=S\\left(0\\right)\\exp\\left(\\int_{0}^{t}\\left[\\alpha\\left(s\\right)-\\dfrac{1}{2}\\beta^{2}\\left(s\\right)\\right]\\mathrm{d}s+\\int_{0}^{t}\\beta\\left(s\\right)\\mathrm{d}W\\left(s\\right)\\right)\n$$\n\n:::\n\n\nAhora considere que \n\\begin{align*}\nf\\left(t\\right) & =\\beta\\left(t\\right)S\\left(t\\right)\\\\\ng\\left(t\\right) & =\\alpha\\left(t\\right)S\\left(t\\right),\n\\end{align*}\n\nCalculamos las parciales de $u$. \n\\begin{align*}\nu_{t} & =0\\\\\nu_{x} & =\\dfrac{1}{x}\\\\\nu_{xx} & =-\\dfrac{1}{x^{2}}\n\\end{align*}\n\nEntonces \n\\begin{align*}\n\\mathrm{d}u\\left(t,S_{t}\\right) & =\\alpha\\left(t\\right)\\mathrm{d}t+\\beta\\left(t\\right)\\mathrm{d}W\\left(t\\right)-\\dfrac{1}{2S_{t}^{2}}\\left(dS_{t}\\right)^{2}\\\\\n & =\\alpha\\left(t\\right)\\mathrm{d}t+\\beta\\left(t\\right)\\mathrm{d}W\\left(t\\right)-\\dfrac{1}{2S_{t}^{2}}\\beta^{2}S_{t}^{2}\\mathrm{d}t\\\\\n & =\\left[\\alpha\\left(t\\right)-\\dfrac{\\beta^{2}\\left(t\\right)}{2}\\right]\\mathrm{d}t+\\beta\\left(t\\right)\\mathrm{d}W\\left(t\\right),\n\\end{align*}\n\nentonces \n\\begin{align*}\n\\ln\\left(\\dfrac{S_{t}}{S_{0}}\\right) & =\\int_{0}^{t}\\left[\\alpha\\left(t\\right)-\\dfrac{\\beta^{2}\\left(t\\right)}{2}\\right]\\mathrm{d}t+\\int_{0}^{t}\\beta\\left(t\\right)\\mathrm{d}W\\left(t\\right)\\\\\nS_{t} & =S_{0}\\exp\\left(\\int_{0}^{t}\\left[\\alpha\\left(t\\right)-\\dfrac{\\beta^{2}\\left(t\\right)}{2}\\right]\\mathrm{d}t+\\int_{0}^{t}\\beta\\left(t\\right)\\mathrm{d}W\\left(t\\right)\\right)\n\\end{align*}\n\n\n\n::: {#exr-1}\n\nConsidere la siguiente ecuación diferencial estocástica lineal. \n$$\n\\mathrm{d}S\\left(t\\right)=\\left(\\alpha\\left(t\\right)\\mathrm{S}\\left(t\\right)\\right)\\mathrm{d}t+\\beta\\left(t\\right)S\\left(t\\right)\\mathrm{d}W\\left(t\\right),S\\left(0\\right)=s_{0},\n$$\n\ncon constantes $s_{0}$ y funciones $\\alpha,\\beta$ integrables. Considere\n\\begin{align*}\n\\alpha\\left(t\\right) & =\\sin\\left(t\\right)\\\\\n\\beta\\left(t\\right) & =\\dfrac{t}{1+t}\\\\\ns_{0} & =1,\n\\end{align*}\nsobre el intervalo $\\left[0,5\\right]$. \n\nUsando el acercamiento apropiado, la salida del código reproduce 200\nrealizaciones de la solución con el proceso de Euler-Maruyama. \n\nAdapta el código para obtener la media de la solución de 1000 realizaciones\ny comparalo con la media de la solución de la forma diferencial, usando\nlos mismos parámetros. Ilustra la diferencia con un log-plot de \n\n$$\n\\ln\\left|S\\left(t\\right)-\\tilde{S}\\left(t\\right)\\right|,\n$$\n\ndonde $S$ es la solución de Euler y $\\tilde{S}$ es la solución de\nla diferencial.\n\n:::\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom PythonScripts import brownian_motion as bw\n\ndef alpha(t):\n    y = np.sin(t)\n    return y\ndef beta(t):\n    y = t / (1.0 + t)\n    return y\n\ndef drift(t, x):\n    a = alpha(t) * x\n    return a\n\ndef diffusion(t, x):\n    b = beta(t) * x\n    return b\n\nsamples = 200\nsigma = 2 ** (-2)\nn_p = 2 ** 8\nT = 5.0\nx_0 = 1.0\n\ndef get_em_solution(x_0, T, N, sigma):\n    x_t = np.zeros(N)\n    x_t[0] = x_0\n    dt = T / N\n    t, W = bw.u(T, N)\n    for i in np.arange(N - 1):\n        w_inc = W[i + 1] - W[i]\n        f = drift(t[i], x_t[i])\n        g = diffusion(t[i], x_t[i])\n        x_t[i + 1] = x_t[i] + f * dt + sigma * g * w_inc  # Importante la sigma.\n    return t, x_t\n\nfig, ax = plt.subplots()\ndf = []\nfor k in np.arange(samples):\n    t, x_t = get_em_solution(x_0, T, n_p, sigma)\n    df.append(x_t)\n    # df.append([t, x_t])\n    ax.plot(t, x_t, color=\"C0\", alpha=0.1)\nplt.show()\n\n\n## Analitico\n\ns_0 = x_0\n\ndef u(t, sigma):\n    y = alpha(t) - 0.5 * (sigma * beta(t)) ** 2\n    return y\ndef v(t,sigma):\n    y = sigma * beta(t)\n    return y\n\ndef ito_n(n_points: int, t: float, sigma: float):\n    time, w = bw.u(t, n_points)\n    integral = np.zeros(n_points)\n    for i in range(n_points - 1):\n        integral[i] = v(time[i], sigma) * (w[i + 1] - w[i])\n    ito = integral.sum()\n    return ito\n\n\ndef riemann_integral(a, b, n_points, sigma):\n    r = np.zeros(n_points)\n    time = np.linspace(a,b,n_points)\n    for i in range(n_points - 1):\n        r[i] = u(time[i], sigma) * (time[i + 1] - time[i])\n    riemann = r.sum()\n    return riemann\n\ndef St(a_0,t,n_p, sigma):\n    rmnn = riemann_integral(0, t, n_p, sigma)\n    ito = ito_n(n_p, t, sigma) \n    y = a_0 * np.exp(rmnn + ito)\n    return y\n\nS = []\nfor i in range(n_p):\n    S.append(St(x_0, t[i], n_p, sigma))\n\nplt.plot(t, S)\nplt.show()\n\n# Simulado EM\n\nem_solutions = np.array(df)\n\nem_mean = em_solutions.mean(axis = 0)\n# Simulado, Solucion General.\n\ngeneral_estimation = np.zeros((samples, n_p))\n\nfor i in range(samples):\n    for j in range(n_p):\n        general_estimation[i, j] = St(x_0, t[j], n_p, sigma)\n\ngeneral_mean = general_estimation.mean(axis = 0)\n\n# \nplt.plot(t, em_mean, 'r')\nplt.plot(t, general_mean, 'b', alpha = 0.5)\nplt.legend(['Euler-Maruyama','Integral de Ito'])\nplt.show()\n\n\n## \nplt.loglog(t, np.abs(em_mean - general_mean))\nplt.title(\"Grafica Log-Plot de |EM(t) - G(t)|\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](Tarea10_files/figure-html/cell-2-output-1.png){width=566 height=411}\n:::\n\n::: {.cell-output .cell-output-display}\n![](Tarea10_files/figure-html/cell-2-output-2.png){width=566 height=411}\n:::\n\n::: {.cell-output .cell-output-display}\n![](Tarea10_files/figure-html/cell-2-output-3.png){width=558 height=411}\n:::\n\n::: {.cell-output .cell-output-display}\n![](Tarea10_files/figure-html/cell-2-output-4.png){width=581 height=432}\n:::\n:::\n\n\n",
    "supporting": [
      "Tarea10_files"
    ],
    "filters": [],
    "includes": {}
  }
}